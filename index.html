<link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABlBMVEX///8AAABVwtN+AAAAAXRSTlMAQObYZgAAAC1JREFUeAFjwAUYGZHYIAClwHwUhThNAAMMlQQEsGhhxGkoXgMZMZwOB7hNAAAaYAAxcvuQHgAAAABJRU5ErkJggg==">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<script>
var game =
{
	canvas:
	{
		load: function ()
		{
			var canvas = window.document.createElement ('canvas');
					canvas.context = canvas.getContext ('2d');
					canvas.font = { face: 'Arial', size: '1em' };
					canvas.redraw = true;
					canvas.scene = [];
					canvas.style.position = 'absolute';
					canvas.z = 0;

			canvas.autosize = function ()
			{
				this.height = window.innerHeight;
				this.width = window.innerWidth;
			};

			canvas.clear = function ()
			{
				canvas.context.clearRect (0, 0, canvas.width, canvas.height);
			};

			canvas.draw =
			{
				set clear (draw)
				{
					for (var id = game.canvas.scene.length; id--;)
					{
						for (var key in draw)
						{
							if (draw[key] == game.canvas.scene[id][key])
							{
								game.canvas.scene.splice (id, 1);
							};
						};
					};
					canvas.redraw = true;
				},

				type: function (draw)
				{
					var type = 'box';
							type = (draw.a) ? 'line' : type;
							type = (draw.image) ? 'image' : type;
							type = (draw.r) ? 'ring' : type;
							type = (draw.text) ? 'text' : type;
					return type;
				}
			};

			canvas.transform =
			{
				abs: function (x)
				{
					var abs = ((x > 0) && (x <=1)) ? x * canvas.width : x;
					return abs;
				},

				font:
				{
					autosize: function (font)
					{
						var face = font.face;
						var size = canvas.transform.abs (font.width) / font.text.length;
						var text = font.text;

						canvas.context.font = size + 'px ' + face;
						var w = canvas.context.measureText (text).width;

						var width = canvas.transform.abs (font.width);
						while (Math.abs (w - width) > 1)
						{
							size = (w > width) ? 0.9 * size : 1.5 * size;
							canvas.context.font = size + 'px ' + face;
							w = canvas.context.measureText (text).width;
						};
						size = Math.floor (size) + 'px';
						return size;
					},

					size: function (metric)
					{
						var h = canvas.transform.ord (metric.h);
						var k = metric.k;
						var w = canvas.transform.abs (metric.w);

						h = (k) ? w * k : h;
						return h + 'px';
					}
				},

				h: function (metric)
				{
					var h = canvas.transform.ord (metric.h);
					var k = metric.k;
					var w = canvas.transform.abs (metric.w);

					h = (k) ? w * k : h;
					return h;
				},

				ord: function (y)
				{
					var ord = ((y > 0) && (y <=1)) ? y * canvas.height : y;
					return ord;
				},

				r: function (metric)
				{
					var r = (canvas.width > canvas.height) ? canvas.transform.ord (metric.r) : canvas.transform.abs (metric.r);
					return r;
				},

				w: function (metric)
				{
					var h = canvas.transform.ord (metric.h);
					var k = metric.k;
					var w = canvas.transform.abs (metric.w);

					w = (k) ? h * k : w;
					return w;
				},

				x: function (metric)
				{
					var k = metric.k;
					var w = canvas.transform.abs (metric.w);
					var x = canvas.transform.abs (metric.x);
							x = (k) ? x - k * w : x;
					return x;
				},

				y: function (metric)
				{
					var k = metric.k;
					var h = canvas.transform.ord (metric.h);
					var y = canvas.transform.ord (metric.y);
							y = (k) ? y - k * h : y;
					return y;
				}
			};

			canvas.update = function ()
			{
				switch (game.event.type)
				{
					case 'load':
						canvas.autosize ();
					break;

					case 'resize':
						canvas.autosize ();
						canvas.redraw = true;
					break;
				};
			};

			delete game['canvas'];
			game.canvas = canvas;

			window.document.body.appendChild (canvas);
		}
	},

	data:
	{
		image: {},

		set load (data)
		{
			for (var tag in data)
			{
				switch (tag)
				{
					case 'image':
						for (var id in data[tag])
						{
							var image = new Image ();
								image.src = data[tag][id];
								game.data.image[id] = image;
						};
					break;
				};
			};
		}
	},

	draw: function ()
	{
		if (game.canvas.redraw)
		{
			var context = game.canvas.context;
			var z = 0;

			game.canvas.clear ();

			while (z <= game.canvas.z)
			{
				for (var id = game.canvas.scene.length; (id--) && (game.canvas.scene.length > 0);)
				{
					var draw = game.canvas.scene[id];
					if (draw.z == z)
					{
						var r = game.canvas.transform.r ({ r: draw.r });
						var h = game.canvas.transform.h ({ h: draw.h, k: draw.hw, w: draw.w });
						var w = game.canvas.transform.w ({ w: draw.w, k: draw.wh, h: draw.h });

						var a = (draw.type == 'ring') ? draw.a : game.canvas.transform.x ({ x: draw.a, k: draw.cx, w: w || 2 * r });
						var b = (draw.type == 'ring') ? draw.b : game.canvas.transform.y ({ y: draw.b, k: draw.cy, h: h || 2 * r });

						var x = game.canvas.transform.x ({ x: draw.x, k: draw.cx, w: w || 2 * r });
						var y = game.canvas.transform.y ({ y: draw.y, k: draw.cy, h: h || 2 * r });

						var _ = (draw.color) && (draw.fill != false) ? context.fillStyle = draw.color : undefined;
								_ = (draw.color) && (draw.fill != true) ? context.strokeStyle = draw.color : undefined;

								_ = (draw.lw) ? context.lineWidth = draw.lw : undefined;

						switch (draw.type)
						{
							case 'box':
								var _ = (draw.fill != false) ? context.fillRect (x, y, w, h) : context.strokeRect (x, y, w, h);
							break;

							case 'image':
								var _ = (h) ? context.drawImage (draw.image, x, y, w, h) : context.drawImage (draw.image, x, y);
							break;

							case 'line':
								context.beginPath ();
								context.moveTo (a, b);
								context.lineTo (x, y);
								var _ = (draw.fill == true) ? context.fill () : context.stroke ();
							break;

							case 'ring':
								context.beginPath ();
								context.arc (x, y, r, a, b);
								var _ = (draw.fill != false) ? context.fill () : context.stroke ();
							break;

							case 'text':
								if (draw.font)
								{
									var face = draw.font.face || game.canvas.font.face;
									var size = draw.font.size || game.canvas.font.size;
											size = (typeof (draw.font.size) == 'number') ? game.canvas.transform.font.size ({ h: draw.font.size }) : size;

									var align = (draw.font.align) ? context.textAlign = draw.font.align : undefined;
									var baseline = (draw.font.baseline) ? context.textBaseline = draw.font.baseline : undefined;


									var width = (draw.font.width) ? context.font = game.canvas.transform.font.autosize ({ face: face, text: draw.text, width: draw.font.width }) + ' ' + face : context.font = size + ' ' + face;
								};
								var	_ = (draw.fill != false) ? context.fillText (draw.text, x, y) : context.strokeText (draw.text, x, y);
							break;
						};
					};
				};
				z++;
			};

			game.canvas.redraw = false;
		};
	},

	event:
	{
		load: function ()
		{
			game.event.manager (event);

			window.onclick = game.event.manager;
			window.onmousemove = game.event.manager;
			window.onresize = game.event.manager;
			window.ontick = game.event.manager;
		},

		manager: function (event)
		{
			game.event.tick = event.tick;
			game.event.time = event.time;
			game.event.type = event.type;
			game.event.x = event.x;
			game.event.y = event.y;
			game.event.run ();
		},

		run: function ()
		{
			game.update ();
			game.draw ();
		}
	},

	load: function ()
	{
		game.window.load ();
		game.canvas.load ();
		game.event.load ();
		game.run ();
	},

	o: {},

	object:
	{
		create:
		{
			set button (button)
			{
				button.tag = 'button';
				game.object.id = button;

				button.active = button.active || {};
				button.in = undefined;

				button.animate = function ()
				{
					if (game.object.in (button))
					{
						if (!button.in)
						{
							button.in = true;
							game.canvas.style.cursor = 'pointer';
							button.show ({ color: button.active.color});
						};
					}
					else
					{
						if (button.in)
						{
							button.in = false;
							game.canvas.style.cursor = 'default';
							button.show ({ color: button.color});
						};
					};
				};

				button.click = function ()
				{
					if (game.object.in (button))
					{
						var _ = (button.action) ? button.action () : undefined;
					};
				};

				button.show = function (draw)
				{
					var color = draw.color;
					var h = button.h;
					var id = 'button' + button.id;
					var image = draw.image;
					var w = button.w;
					var x = button.x;
					var y = button.y;
					var z = button.z;

					game.canvas.draw.clear = { id: id };

					switch (game.canvas.draw.type (button))
					{
						case 'box':
							game.paint = { color: color, h: h, id: id, w: w, x: x, y: y, z: z };
						break;

						case 'image':
							game.paint = { image: image, h: h, id: id, w: w, x: x, y: y, z: z };
						break;
					};
				},

				button.update = function ()
				{
					switch (game.event.type)
					{
						case 'click':
							button.click ();
						break;

						case 'mousemove':
							button.animate ();
						break;
					};
				};

				button.show ({ color: button.color, image: button.color });
				game.object.load = button;
			}
		},

		set destroy (destroy)
		{

		},

		set id (object)
		{
			var tag = object.tag;
			var _ = (game.o[tag] == undefined) ? game.o[tag] = {} : undefined;
			object.id = object.id || Object.keys (game.o[tag]).length;
		},

		in: function (object)
		{
			var h = game.canvas.transform.h ({ h: object.h, k: object.hw, w: object.w });
			var w = game.canvas.transform.w ({ w: object.w, k: object.wh, h: object.h });
			var x = game.canvas.transform.x ({ x: object.x, k: object.cx, w: object.w });
			var y = game.canvas.transform.y ({ y: object.y, k: object.cy, h: object.h });
			var result = ((game.event.x >= x) && (game.event.x <= x + w) && (game.event.y >= y) && (game.event.y <= y + h));
			return result;
		},

		set load (object)
		{
			game.o[object.tag][object.id] = object;
		},

		update: function ()
		{
			for (var tag in game.o)
			{
				for (var id in game.o[tag])
				{
					game.o[tag][id].update ();
				};
			};
		}
	},

	set paint (paint)
	{
		paint.id = paint.id || game.canvas.scene.length;

		paint.type = game.canvas.draw.type (paint);

		switch (paint.type)
		{
			case 'ring':
				paint.a = paint.a || 0;
				paint.b = paint.b || 2 * Math.PI;
			break;

			case 'text':
				if (paint.font)
				{
					game.canvas.font.face = paint.font.face || game.canvas.font.face;
					game.canvas.font.size = paint.font.size || game.canvas.font.size;
				};
			break;
		};

		paint.z = paint.z || 0;
		game.canvas.z = (paint.z > game.canvas.z) ? game.canvas.z = paint.z : game.canvas.z;

		game.canvas.scene[game.canvas.scene.length] = paint;
		game.canvas.redraw = true;
	},

	update: function (update)
	{
		game.canvas.update ();
		game.object.update ();
	},

	window:
	{
		load: function ()
		{
			Object.defineProperties
			(
				window,
				{
					'load':
					{
						set: function (load)
						{
							load ();
						}
					},

					'log':
					{
						set: function (message)
						{
							window.console.log (message);
						}
					},

					'ontick':
					{
						set: function (f)
						{
							window.clock = window.setInterval
							(
								function ()
								{
									f ({ tick: window.tick, time: window.time, type: 'tick' });
									window.time += window.tick;
								},
								window.tick
							);
						}
					},

					'tick':
					{
						value: 100,
						writable: true
					},

					'time':
					{
						value: 0,
						writable: true
					}
				}
			);

			window.load = function ()
			{
				window.document.body.style.margin = 0;
			};

			delete game['window'];

			game.window = window;
		}
	}
};

window.onload = game.load;

game.data.load =
{
	image:
	{
		logo: 'logo.png'
	}
};

game.run = function ()
{
	game.paint = { a: 0.5, b: 0.5, color: 'black', lw: 10, x: 300, y: 200,  z: 1 };

	game.paint = { x: 0.5, cx: 0.5, y: 0.5, cy: 0.5, h: 0.1, w: 0.1, color: 'blue', z: 1 };
	game.paint = { x: 0.5, y: 0.5, r: 0.25, color: 'red', z: 0 };

	game.paint = { x: 700, y: 100, image: game.data.image.logo };

	game.paint = { x: 0.5, y: 0.5, text: 'text', font: { face: 'Consolas', size: 0.4, align: 'center', baseline: 'middle' }, z: 3 };

	game.object.create.button =
	{
		action: function ()
		{
			window.log = 'click';
		},
		active:
		{
			color: '#aaa'
		},
		color: '#888',
		h: 100,
		w: 100,
		x: 0.1,
		y: 0.5
	};
};

</script>
